<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Ambientes de Execução (Flask)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 960px; margin: 40px auto; background-color: #f4f4f4; }
        h1, h2 { color: #2c3e50; }
        .container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        form { display: flex; flex-direction: column; gap: 15px; }
        label { font-weight: bold; }
        input[type="text"], input[type="number"], textarea { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background-color: #ecf0f1; }
        .status { padding: 5px 10px; border-radius: 12px; color: white; font-size: 0.8em; text-align: center; display: inline-block; }
        .status-executando { background-color: #27ae60; }
        .status-concluido { background-color: #7f8c8d; }
        .status-erro { background-color: #e74c3c; }
        .actions a { text-decoration: none; color: #007bff; margin-right: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gerenciador de Ambientes (Flask)</h1>
        <p>Crie um novo ambiente de execução com recursos limitados.</p>

        <form action="{{ url_for('index') }}" method="POST">
            <h2>Novo Ambiente</h2>
            <label for="nome">Nome do Ambiente:</label>
            <input type="text" id="nome" name="nome" placeholder="Ex: Meu Servidor Web" required>

            <label for="comando">Comando a ser executado:</label>
            <textarea id="comando" name="comando" rows="3" placeholder="Ex: while true; do echo `date`; sleep 1; done" required></textarea>

            <label for="cpu_limit">Limite de CPU (% de 1 core - opcional):</label>
            <input type="number" id="cpu_limit" name="cpu_limit" placeholder="Ex: 50">

            <label for="mem_limit">Limite de Memória (MB - opcional):</label>
            <input type="number" id="mem_limit" name="mem_limit" placeholder="Ex: 256">

            <button type="submit">Criar e Executar</button>
        </form>

        <hr style="margin: 30px 0;">

        <h2>Ambientes Ativos</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Status</th>
                    <th>PID</th>
                    <th>Criado em</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for ambiente in ambientes %}
                <tr>
                    <td>{{ ambiente.id }}</td>
                    <td>{{ ambiente.nome }}</td>
                    <td><span class="status status-{{ ambiente.status.lower() }}">{{ ambiente.status }}</span></td>
                    <td>{{ ambiente.pid or 'N/A' }}</td>
                    <td>{{ ambiente.data_criacao }}</td>
                    <td class="actions">
                        <a href="{{ url_for('static', filename=ambiente.output_file) }}" target="_blank">Output</a>
                        <a href="{{ url_for('terminar', id=ambiente.id) }}" onclick="return confirm('Tem certeza?')">Terminar</a>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="6">Nenhum ambiente criado ainda.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>
